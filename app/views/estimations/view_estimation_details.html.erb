<div class="row">
    <div class="col-lg-12">
        <div class="ibox ">
            <div class="ibox-title">
                <h5><%= @template.name %> Estimation for <%= @estimation.name %></h5>
            </div>
        </div>
    </div>
</div>
<% functional_scope = @estimation.functional_scope %>

<%= render 'functional_scope_view' if functional_scope.present? %>
<% details = @estimation.estimation_details %>
<% if details.present? && functional_scope.present?%>
  <div class="row">
    <div class="col-lg-12">
        <div class="ibox ">
          <div class="ibox-title">
              <h5><%= details[0]&.category_name %></h5>
              <div class="ibox-tools">
                  <a class="collapse-link">
                      <i class="fa fa-chevron-up"></i>
                  </a>
              </div>
          </div>
          <div class="ibox-content custom-ibox">
            <div class="row">
              <div class="col-lg-3">
                Development Components
              </div>
              <div class="col-lg-1">
                Applicable(Y/N)
              </div>
              <div class="col-lg-3">
                Per Component (Low / Medium / High)
              </div>
              <div class="col-lg-3">
                # of Component (Low / Medium / High)
              </div>
              <div class="col-lg-2">
                Total Estimated / Overridden
              </div>
            </div>
          </div>

          
          <% details.each do |detail| %>
            <!-- Calculation goes here -->  
            <%
              per_component_low = detail.per_component_low
              per_component_medium = detail.per_component_medium
              per_component_high = detail.per_component_high
              component_low_count = detail.component_low_count
              component_medium_count = detail.component_medium_count
              component_high_count = detail.component_high_count
              estimated_total = detail.estimated_total
              overridden_total = detail.overridden_total
              sub_category_name = detail.sub_category_name
            %>



            <div class="ibox-content custom-ibox">
              <div class="row">
                <div class="col-lg-3 custom-col">
                  <%= text_field_tag 'estimation_details[sub_category_name][]', sub_category_name, :class =>  "form-control custom-input", :placeholder => 'Sub category name', readonly: true %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= text_field_tag 'estimation_details[applicable][]', Estimation::APPLICABLE.key(detail.applicable), :class =>  "form-control custom-input", :placeholder => '(Y/N)', readonly: true %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[per_component_low][]', per_component_low, :class =>  "form-control custom-input",:placeholder => 'Low', readonly: true, style: 'border-color: yellow;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[per_component_medium][]', per_component_medium, :class =>  "form-control custom-input",:placeholder => 'Medium', readonly: true, style: 'border-color: orange;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[per_component_high][]', per_component_high, :class =>  "form-control custom-input",:placeholder => 'High', readonly: true, style: 'border-color: green;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[component_low_count][]', component_low_count, :class =>  "form-control custom-input",:placeholder => 'Low', readonly: true, style: 'border-color: yellow;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[component_medium_count][]', component_medium_count, :class =>  "form-control custom-input",:placeholder => 'Medium', readonly: true, style: 'border-color: orange;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[component_high_count][]', component_high_count, :class =>  "form-control custom-input",:placeholder => 'High', readonly: true, style: 'border-color: green;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[estimated_total][]', estimated_total, :class =>  "form-control custom-input", readonly: true, style: 'font-weight: bold;' %>
                </div>
                <div class="col-lg-1 custom-col">
                  <%= number_field_tag 'estimation_details[overridden_total][]', overridden_total, :class =>  "form-control custom-input", style: 'font-weight: bold;', readonly: true %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
  </div>
<% end %>

<!-- OFFER -->

<div class="row">
    <div class="col-lg-8">
        <div class="ibox ">
            <div class="ibox-title">
                <h5>Get Exciting Offers on Development from UI Garage only!</h5>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="ibox "><div class="ibox-title">
            <%= select_tag 'estimation_details[offer_flag]', options_for_select(SubCategory::OFFER), prompt: "Add Offer", class: 'form-control', style: 'border-color: red;' %>
        </div></div>
    </div>
</div>

<div>
  <% @estimation.estimation_offers.each do |offer| %>
    <div class="row">
        <div class="col-lg-12">
          <div class="ibox ">
            <div class="ibox-title">
              <h5><%= offer.category_name %></h5>
              <div class="ibox-tools">
                  <a class="collapse-link">
                      <i class="fa fa-chevron-up"></i>
                  </a>
              </div>
            </div>
              <div class="ibox-content custom-ibox">
                  <div class="row">
                      <div class="col-lg-8">
                          <%= text_field_tag 'estimation_offers[sub_category_name][]', offer.sub_category_name, :class =>  "form-control", :placeholder => 'Sub category name', readonly: true %>
                      </div>
                      <div class="col-lg-4">
                          <%= text_field_tag 'estimation_offers[hours][]', "- #{offer.hours} Hours", :class =>  "form-control", :placeholder => 'Free Hours', readonly: true, style: 'background-color: lightgreen;' %>
                      </div>
                      
                  </div>
              </div>
          </div>
        </div>
    </div>
  <% end %>
</div>



<p class="text-muted text-center" style="margin-bottom: 60px;"></p>
